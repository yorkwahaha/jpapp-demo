<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥èªåŠ©è© RPGï¼šé­”ç‹åŸå¤§å†’éšª</title>
    <!-- Azure TTS Dev Keys (local only) -->
    <script>
        // Load local-only config if present (ignored on GitHub Pages)
        (function () {
            const s = document.createElement("script");
            s.src = "config.local.js";
            s.defer = true;
            s.onerror = () => console.log("[local] config.local.js not found (expected on Pages).");
            document.head.appendChild(s);
        })();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&family=Noto+Sans+TC:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css?v=26022703">

</head>

<body class="p-4 md:p-8">
    <div id="app" v-cloak class="w-full max-w-6xl mx-auto relative" @pointerdown="onUserGesture"
        :class="{ shake: screenShake }">
        <div
            class="absolute top-2 right-4 text-[10px] text-slate-500/80 font-mono tracking-wider pointer-events-none z-50">
            v{{ appVersion }}</div>
        <!-- Menu button -->
        <!-- Level select menu only -->
        <div v-if="showLevelSelect"
            class="card rounded-3xl shadow-2xl overflow-hidden border border-amber-500/30 p-12 text-center bg-slate-900/90 backdrop-blur-xl">
            <h1 class="text-4xl font-black text-amber-400 mb-4 tracking-tighter">æ—¥èªåŠ©è© RPGï¼šé­”ç‹åŸå¤§å†’éšª</h1>
            <p class="text-slate-400 mb-6 text-lg">é¸æ“‡é›£åº¦é–‹å§‹æŒ‘æˆ°</p>

            <div class="flex justify-center gap-6 mb-12">
                <button @click="difficulty = 'easy'"
                    :class="difficulty === 'easy' ? 'border-emerald-500 bg-emerald-500/30 text-emerald-300 scale-110 shadow-[0_0_20px_rgba(16,185,129,0.2)]' : 'border-slate-700 text-slate-500 hover:border-slate-500'"
                    class="px-10 py-5 rounded-2xl border-2 font-black text-xl transition-all duration-300">åˆç´š
                    (Easy)</button>
                <button @click="difficulty = 'hard'"
                    :class="difficulty === 'hard' ? 'border-rose-500 bg-rose-500/30 text-rose-300 scale-110 shadow-[0_0_20px_rgba(225,29,72,0.2)]' : 'border-slate-700 text-slate-500 hover:border-slate-500'"
                    class="px-10 py-5 rounded-2xl border-2 font-black text-xl transition-all duration-300">é«˜ç´š
                    (Hard)</button>
            </div>

            <div
                class="max-w-md mx-auto space-y-4 mb-8 text-slate-400 text-sm bg-slate-800/40 p-6 rounded-2xl border border-slate-700">
                <div class="flex items-center gap-3">
                    <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                    <span>åˆç´šæ¨¡å¼ï¼šç­”éŒ¯å¾Œ 2 ç§’å¯ç¹¼çºŒæ‰‹å‹•è·³é¡Œã€‚</span>
                </div>
                <div class="flex items-center gap-3">
                    <span class="w-2 h-2 rounded-full bg-rose-500"></span>
                    <span>é«˜ç´šæ¨¡å¼ï¼šç­”éŒ¯æˆ–æ™‚é–“åˆ° 3 ç§’å¾Œè‡ªå‹•é€²å…¥ä¸‹ä¸€é¡Œã€‚</span>
                </div>
            </div>

            <button @click="startLevel(1)"
                class="group relative inline-flex items-center justify-center px-16 py-6 font-black text-2xl tracking-widest text-slate-900 transition-all duration-200 bg-amber-500 rounded-2xl hover:bg-amber-400 active:scale-95 shadow-xl border-b-8 border-amber-700">
                é–‹å§‹æˆ°é¬¥
            </button>
        </div>

        <div v-else id="stageWrap" class="w-full flex justify-center">
            <div id="stage" class="rounded-3xl shadow-2xl overflow-hidden border border-white/50">
                <!-- Top Bar Removed -->

                <!-- #battleScene: upper half with enemy -->
                <div id="battleScene" class="transition-all duration-300"
                    :style="{ backgroundImage: 'url(' + currentBg + ')' }"
                    :class="{'bg-dodge': isPlayerDodging, 'brightness-50 grayscale saturate-50': (hasSubmitted && !isCurrentCorrect)}">

                    <!-- INSERT BEGIN: JPAPP_BATTLELOG_HTML_V1 -->
                    <div id="battleLog" class="battle-log" aria-live="polite"></div>
                    <!-- INSERT END: JPAPP_BATTLELOG_HTML_V1 -->
                    <div
                        class="absolute top-4 left-4 px-3 py-1 bg-slate-900/80 rounded-lg border border-amber-500/30 text-xs font-bold text-amber-500 shadow-md">
                        ç¬¬ {{ currentLevel }} é—œ â€¢ {{ difficulty === 'easy' ? 'Easy' : 'Hard' }}
                    </div>

                    <!-- æ€ªç‰© -->
                    <div v-if="!monsterDead"
                        class="flex flex-col items-center p-6 rounded-2xl bg-slate-800/40 border border-rose-500/20 relative mt-12"
                        :class="{ hit: monsterHit }">
                        <!-- èˆŠçš„ log-bubble å·²ç§»é™¤ -->

                        <!-- Radial ATB Timer (Top Right) -->
                        <div v-if="!isFinished && !monsterDead && !playerDead" class="absolute top-3 right-3 w-10 h-10">
                            <svg class="w-10 h-10 transform -rotate-90">
                                <circle cx="20" cy="20" r="16" stroke="currentColor" stroke-width="3" fill="transparent"
                                    class="text-slate-800" />
                                <circle cx="20" cy="20" r="16" stroke="currentColor" stroke-width="3" fill="transparent"
                                    :stroke-dasharray="100.5" :stroke-dashoffset="100.5 * (1 - timeLeft / 10)"
                                    class="text-amber-500 transition-all duration-100 ease-linear shadow-[0_0_8px_rgba(245,158,11,0.6)]" />
                            </svg>
                        </div>

                        <div
                            class="w-28 h-28 rounded-full bg-rose-900/80 flex items-center justify-center text-5xl mb-3 shadow-lg ring-4 ring-rose-500/20">
                            {{ monster.sprite || 'ğŸ‘¹' }}
                        </div>
                        <span class="text-base font-bold text-slate-200 mb-1">{{ monster.name }}</span>
                        <span class="text-xs text-amber-400/80 mb-3">{{ monster.trait }}</span>

                        <!-- HP Bar -->
                        <div class="w-full h-1.5 bg-slate-900/50 rounded-full overflow-hidden mb-1 border border-slate-700/30"
                            style="width: 140px;">
                            <div class="h-full bg-rose-600 shadow-[0_0_8px_rgba(225,29,72,0.4)] transition-all duration-500"
                                :style="{ width: (monster.hp / monster.maxHp * 100) + '%' }"></div>
                        </div>
                        <!-- Monster Status Bar -->
                        <div id="monsterStatusBar" class="w-full flex justify-center gap-1 mt-1 min-h-[22px]"></div>
                    </div>
                    <!-- èˆŠçš„ log-bubble å·²ç§»é™¤ -->
                </div>

                <!-- #hud: lower half with player, questions, actions -->
                <!-- NEW HUD LAYOUT -->
                <div id="hud" v-if="!isFinished" :class="{'hud-shake': screenShake}"
                    class="flex-1 flex flex-row gap-4 p-4 bg-slate-900/90 rounded-b-3xl w-full h-full overflow-hidden">

                    <!-- Left Column (Area 1 & 2) -->
                    <div class="w-64 flex flex-col gap-4 shrink-0 h-full">
                        <!-- Area 1: Party and Stats -->
                        <div class="flex-1 border-2 border-amber-500/60 rounded-xl p-3 flex flex-col gap-2 relative bg-slate-800/60 shadow-[inset_0_0_20px_rgba(0,0,0,0.5)] overflow-hidden"
                            style="min-height: 220px;">
                            <!-- Player 1 (Active) -->
                            <div
                                class="flex flex-col items-center bg-slate-900/80 py-4 px-3 rounded-2xl border border-slate-700 shadow-md w-full relative">

                                <div class="w-full flex justify-center mb-3">
                                    <img id="heroAvatar" src="assets/images/hero/hero_neutral.png" alt=" Hero"
                                        class="hero-avatar-img">
                                </div>

                                <div class="w-full flex justify-between items-end mb-1 px-1">
                                    <span class="text-xs font-black text-slate-300 tracking-widest">å‹‡è€…</span>
                                    <span class="text-xs font-mono font-bold">{{ player.hp }}/{{ player.maxHp }}</span>
                                </div>

                                <div class="hp-bar-wrap h-3 shadow-inner w-full mb-1.5">
                                    <div class="hp-bar-fill shadow-[0_0_10px_rgba(255,255,255,0.2)]"
                                        :class="[getHpColorClass(player.hp, player.maxHp), { danger: hpBarDanger, 'player-blink': playerBlink }]"
                                        :style="{ width: (player.hp / player.maxHp * 100) + '%' }"></div>
                                </div>

                                <div class="sp-row w-full flex items-center gap-2 mb-2">
                                    <span class="sp-label text-[10px] font-black text-cyan-400 tracking-wider">SP</span>
                                    <div
                                        class="sp-bar-wrap h-2 flex-1 bg-slate-800 rounded-full shadow-inner overflow-hidden border border-slate-700/50">
                                        <div id="spFill"
                                            class="sp-fill h-full bg-gradient-to-r from-cyan-600 to-cyan-400 shadow-[0_0_8px_rgba(34,211,238,0.4)] transition-all duration-300"
                                            style="width: 100%;"></div>
                                    </div>
                                    <span id="spText"
                                        class="sp-text text-[9px] font-mono font-bold text-slate-300">20/20</span>
                                </div>

                                <div id="heroStatusBar" class="hero-statusbar w-full justify-start min-h-[22px]"></div>
                            </div>

                            <!-- Empty slots Removed -->

                            <!-- Gold (Moved slightly) -->
                            <div class="mt-auto pt-2 border-t-2 border-slate-700/50 flex px-1 shrink-0">
                                <div
                                    class="w-full flex justify-between items-center bg-slate-900/50 px-3 py-2 rounded-lg border border-slate-700/50 shadow-inner">
                                    <span class="text-amber-400 text-xs font-black tracking-widest">ğŸ’° GOLD</span>
                                    <span class="text-amber-400 text-base font-mono font-bold">{{ player.gold }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Area 2: System / Codex / Potion / Backpack (1x4 Row) -->
                        <div class="left-actionbar shrink-0 border-2 border-amber-500/60 rounded-xl p-2.5 bg-slate-800/60 shadow-[inset_0_0_20px_rgba(0,0,0,0.5)]"
                            style="height: 86px;">
                            <button @click="openSkillOverlay(); pauseBattle();" title="æŠ€èƒ½"
                                class="action-btn bg-gradient-to-t from-amber-700 to-amber-600 hover:from-amber-600 hover:to-amber-500 border border-amber-400/50 shadow-lg transition-transform active:scale-95 text-amber-100">
                                <span class="icon flex items-center justify-center text-2xl">ğŸ“–</span>
                                <span class="label tracking-widest">æŠ€èƒ½</span>
                            </button>

                            <button @click="usePotion()" title="å›å¾©è—¥æ°´"
                                class="action-btn bg-gradient-to-t from-emerald-700 to-emerald-600 hover:from-emerald-600 hover:to-emerald-500 shadow-lg border border-emerald-400/50 text-emerald-100 transition-transform active:scale-95"
                                :class="{ 'opacity-40 cursor-not-allowed grayscale': inventory.potions <= 0 || player.hp >= player.maxHp || monsterDead || playerDead }"
                                :disabled="inventory.potions <= 0 || player.hp >= player.maxHp || monsterDead || playerDead">
                                <span class="icon flex items-center justify-center text-2xl">ğŸ§ª</span>
                                <span class="label tracking-widest">é“å…·</span>
                                <span
                                    class="badge bg-rose-600 border border-rose-300 text-white text-[11px] font-black px-1.5 py-0.5 min-w-[20px] rounded-full shadow-md z-10">{{
                                    inventory.potions }}</span>
                            </button>

                            <button @click="isInventoryOpen = true; pauseBattle();" title="èƒŒåŒ…"
                                class="action-btn bg-gradient-to-t from-slate-700 to-slate-600 hover:from-slate-600 hover:to-slate-500 text-slate-200 transition-transform active:scale-95 border border-slate-500/50 shadow-lg">
                                <span class="icon flex items-center justify-center text-2xl">ğŸ’</span>
                                <span class="label tracking-widest">èƒŒåŒ…</span>
                            </button>

                            <button @click="isMenuOpen = !isMenuOpen; isMenuOpen ? pauseBattle() : resumeBattle()"
                                title="ç³»çµ±"
                                class="action-btn bg-gradient-to-t from-slate-700 to-slate-600 hover:from-slate-600 hover:to-slate-500 text-slate-200 transition-transform active:scale-95 border border-slate-500/50 shadow-lg">
                                <span class="icon flex items-center justify-center text-2xl">âš™ï¸</span>
                                <span class="label tracking-widest">ç³»çµ±</span>
                            </button>
                        </div>
                    </div>

                    <!-- Right Column (Area 3): Commands & Results -->
                    <div
                        class="flex-1 border-2 border-amber-500/60 rounded-xl p-6 flex flex-col relative bg-slate-800/60 shadow-[inset_0_0_20px_rgba(0,0,0,0.5)] overflow-hidden">
                        <div class="absolute top-4 right-5 text-right flex items-center gap-2">
                            <span v-if="comboCount > 1"
                                class="text-rose-400 font-black text-sm animate-bounce inline-block">ğŸ”¥ {{ comboCount }}
                                COMBO</span>
                        </div>

                        <div class="flex flex-col items-center justify-center flex-1 w-full gap-4 relative">
                            <div v-if="!monsterDead && !playerDead"
                                class="flex flex-col items-center justify-center w-full flex-1">
                                <!-- Integrated Question Area -->
                                <div id="question-area" class="w-full mb-1 flex flex-col items-center">
                                    <div class="text-slate-300/80 font-bold mb-2 text-sm tracking-widest drop-shadow">{{
                                        currentQuestion?.chinese || '' }}</div>
                                    <div class="flex flex-wrap justify-center items-center gap-2">
                                        <span v-for="(seg, idx) in displaySegments" :key="idx"
                                            class="inline-flex items-center">
                                            <span v-if="!seg.isBlank" class="text-slate-100">
                                                <ruby v-if="seg.ruby">{{ seg.text }}<rt>{{ seg.ruby }}</rt></ruby>
                                                <span v-else>{{ seg.text }}</span>
                                            </span>
                                            <div v-else-if="seg.showInput && !isChoiceMode">
                                                <input v-model="userAnswers[seg.blankIndex]" :disabled="hasSubmitted"
                                                    class="particle-input px-2 py-0.5 text-lg"
                                                    :class="getInputStyle(seg.blankIndex)" type="text"
                                                    spellcheck="false">
                                            </div>
                                            <span v-else-if="seg.showInput && isChoiceMode" class="particle-slot"
                                                :class="[getInputStyle(seg.blankIndex), { 'is-empty': !hasSubmitted && !userAnswers[seg.blankIndex] }]">
                                                {{ hasSubmitted ? getAnswerForDisplay(seg.blankIndex) :
                                                (userAnswers[seg.blankIndex] || '\u00A0') }}
                                            </span>
                                            <span v-else
                                                class="particle-input correct inline-block px-2 py-0.5 text-lg">{{
                                                getAnswerForDisplay(seg.blankIndex) }}</span>
                                        </span>
                                    </div>
                                </div>
                                <div v-if="isChoiceMode && currentQuestion.choices && !hasSubmitted"
                                    class="flex flex-wrap justify-center gap-3 w-full">
                                    <button v-for="opt in currentQuestion.choices" :key="opt" @click="selectChoice(opt)"
                                        class="particle-option px-6 py-2 rounded-xl text-xl font-black transition-all border-2"
                                        :class="getChoiceBtnClass(opt)">
                                        {{ opt }}
                                    </button>
                                </div>
                                <div v-else-if="hasSubmitted" class="text-center w-full">
                                    <div class="inline-flex flex-col items-center gap-2">
                                        <div class="inline-flex items-center gap-3 px-6 py-2 rounded-xl bg-slate-900/80 border-2 transition-all"
                                            :class="isCurrentCorrect ? 'border-emerald-500/50' : 'border-rose-500/50'">
                                            <span v-if="isCurrentCorrect"
                                                class="text-emerald-400 text-xl font-black flex items-center gap-2">
                                                <span
                                                    class="bg-emerald-500 text-slate-900 rounded-full w-6 h-6 flex items-center justify-center text-[10px]">âœ“</span>
                                                æ­£ç¢ºï¼
                                            </span>
                                            <span v-else
                                                class="text-rose-400 text-xl font-black flex items-center gap-2">
                                                <span
                                                    class="bg-rose-500 text-slate-200 rounded-full w-6 h-6 flex items-center justify-center text-[10px]">âœ•</span>
                                                æ”»æ“Šå¤±æ•—
                                            </span>
                                        </div>
                                        <div v-if="showGrammarDetail && currentQuestion.grammarTip"
                                            class="grammar-card mt-2 rounded-2xl p-4 text-amber-100 text-sm max-w-md shadow-xl border-l-8 border-amber-500">
                                            {{ currentQuestion.grammarTip }}
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="flex justify-center gap-3 mt-3 w-full max-w-lg">
                                    <button v-if="hasSubmitted && !isCurrentCorrect" @click="nextQuestion"
                                        class="w-48 bg-amber-500 text-slate-900 px-6 py-2 rounded-xl font-black text-lg hover:bg-amber-400 shadow-lg border-b-4 border-amber-700 active:translate-y-1 active:border-b-0 transition-all">
                                        æ¬¡ï¼ˆã¤ãï¼‰
                                    </button>
                                    <button v-else @click="checkAnswer"
                                        class="w-48 bg-amber-500 text-slate-900 px-6 py-2 rounded-xl font-black text-lg hover:bg-amber-400 shadow-lg border-b-4 border-amber-700 active:translate-y-1 active:border-b-0 transition-all"
                                        :class="(isChoiceMode && !userAnswers[0]) ? 'bg-slate-700 border-slate-800 text-slate-500 cursor-not-allowed opacity-50' : ''"
                                        :disabled="isChoiceMode && !userAnswers[0]">
                                        æ”»æ’ƒï¼ˆã“ã†ã’ãï¼‰
                                    </button>
                                    <!-- TTS Button -->
                                    <button @click="playQuestionVoice"
                                        class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-xl shadow-lg border-b-4 border-blue-800 transition-all">
                                        <span class="text-xl">ğŸ”Š</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Victory/Loss States -->
                            <div v-else class="flex flex-col items-center justify-center w-full flex-1">
                                <div v-if="monsterDead"
                                    class="flex flex-row items-center justify-center gap-12 py-4 w-full px-6 flex-1">
                                    <!-- Left side -->
                                    <div class="flex flex-col items-center max-w-[200px]">
                                        <div class="text-6xl mb-2 flex-shrink-0">ğŸ†</div>
                                        <h2
                                            class="text-3xl font-black text-amber-400 mb-6 tracking-widest whitespace-nowrap">
                                            {{ currentLevel >= 3
                                            ? 'å…¨ç« ç¯€ç ´é—œï¼' : 'æˆ°é¬¥çªç ´ï¼' }}</h2>
                                        <button v-if="currentLevel < 3" @click="goNextLevel"
                                            class="w-full px-8 py-4 rounded-2xl bg-amber-500 text-slate-900 font-black text-xl hover:bg-amber-400 shadow-[0_6px_0_#b45309] active:translate-y-1 active:shadow-none transition-all">ä¸‹ä¸€é—œ</button>
                                        <button v-else @click="startOver"
                                            class="w-full px-8 py-4 rounded-2xl bg-amber-500 text-slate-900 font-black text-xl hover:bg-amber-400 shadow-[0_6px_0_#b45309] active:translate-y-1 active:shadow-none transition-all">å›åˆ°é¦–é </button>
                                        <button @click="isMistakesOpen = true"
                                            class="w-full mt-3 px-6 py-3 rounded-2xl bg-blue-600 text-white font-black text-lg hover:bg-blue-500 shadow-[0_4px_0_#1e40af] active:translate-y-1 active:shadow-none transition-all">ğŸ“’
                                            éŒ¯é¡Œæœ¬</button>
                                    </div>

                                    <!-- Right side -->
                                    <div
                                        class="bg-slate-900/80 p-5 rounded-2xl border border-amber-500/30 shadow-xl w-64 flex-shrink-0">
                                        <div class="flex justify-between items-center mb-4">
                                            <span class="text-slate-400 font-bold">è©•åƒ¹</span>
                                            <span class="text-6xl font-black leading-none"
                                                :class="getGradeColor(calculatedGrade)">{{
                                                calculatedGrade }}</span>
                                        </div>
                                        <div class="flex justify-between items-center mb-2 text-sm">
                                            <span class="text-slate-400">æ­£ç¢ºç‡</span>
                                            <span class="text-emerald-400 font-mono font-bold">{{ accuracyPct }}%</span>
                                        </div>
                                        <div class="flex justify-between items-center mb-2 text-sm">
                                            <span class="text-slate-400">æœ€å¤§ Combo</span>
                                            <span class="text-rose-400 font-mono font-bold">{{ maxComboCount }}</span>
                                        </div>
                                        <div class="flex justify-between items-center mb-2 text-sm">
                                            <span class="text-slate-400">ç²å¾—ç¶“é©—å€¼</span>
                                            <span class="text-blue-400 font-mono font-bold">+{{ earnedExp }}</span>
                                        </div>
                                        <div class="flex justify-between items-center text-sm">
                                            <span class="text-slate-400">ç²å¾—é‡‘å¹£</span>
                                            <span class="text-amber-400 font-mono font-bold">+{{ earnedGold }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div v-else
                                    class="flex flex-row items-center justify-center gap-12 py-4 w-full px-6 flex-1">
                                    <!-- Left side -->
                                    <div class="flex flex-col items-center max-w-[200px]">
                                        <div class="text-6xl mb-2 flex-shrink-0">ğŸ’€</div>
                                        <h2
                                            class="text-3xl font-black text-rose-400 mb-6 tracking-widest whitespace-nowrap">
                                            æ•—åŒ—...</h2>
                                        <div class="flex flex-col gap-3 w-full">
                                            <button @click="isMistakesOpen = true"
                                                class="w-full px-6 py-3 rounded-2xl bg-blue-600 text-white font-black text-lg hover:bg-blue-500 shadow-[0_4px_0_#1e40af] active:translate-y-1 active:shadow-none transition-all">ğŸ“’
                                                éŒ¯é¡Œæœ¬</button>
                                            <button @click="revive"
                                                class="w-full px-6 py-3 rounded-2xl bg-emerald-600 text-white font-black text-lg hover:bg-emerald-500 shadow-[0_4px_0_#065f46] active:translate-y-1 active:shadow-none transition-all">é‡æ–°é–‹å§‹</button>
                                        </div>
                                    </div>

                                    <!-- Right side -->
                                    <div
                                        class="bg-slate-900/80 p-5 rounded-2xl border border-rose-500/30 shadow-xl w-64 flex-shrink-0">
                                        <div class="flex justify-between items-center mb-4">
                                            <span class="text-slate-400 font-bold">è©•åƒ¹</span>
                                            <span class="text-6xl font-black leading-none"
                                                :class="getGradeColor(calculatedGrade)">{{
                                                calculatedGrade }}</span>
                                        </div>
                                        <div class="flex justify-between items-center mb-2 text-sm">
                                            <span class="text-slate-400">æ­£ç¢ºç‡</span>
                                            <span class="text-emerald-400 font-mono font-bold">{{ accuracyPct }}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-else
                    class="py-12 flex-1 flex flex-col justify-center items-center bg-slate-900/40 backdrop-blur-md min-h-[400px]">
                    <div class="text-8xl mb-4 animate-bounce">ğŸ‰</div>
                    <h2 class="text-5xl font-black text-amber-400 mb-10 tracking-widest">é€šé—œæˆåŠŸï¼</h2>

                    <div class="flex flex-row items-stretch justify-center gap-16 w-full px-6 max-w-4xl">
                        <!-- Left side: Actions -->
                        <div class="flex flex-col gap-4 flex-1 justify-center max-w-[240px]">
                            <button v-if="currentLevel < 3" @click="goNextLevel"
                                class="w-full bg-amber-500 text-slate-900 px-6 py-4 rounded-2xl font-black text-2xl hover:bg-amber-400 shadow-[0_8px_0_#b45309] active:translate-y-1 active:shadow-none transition-all">ä¸‹ä¸€é—œ</button>
                            <button v-else @click="startOver"
                                class="w-full bg-amber-500 text-slate-900 px-6 py-4 rounded-2xl font-black text-2xl hover:bg-amber-400 shadow-[0_8px_0_#b45309] active:translate-y-1 active:shadow-none transition-all">å›é¦–é </button>
                            <button @click="isMistakesOpen = true"
                                class="w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-bold text-lg hover:bg-blue-500 shadow-[0_4px_0_#1e40af] active:translate-y-1 active:shadow-none transition-all">ğŸ“’
                                éŒ¯é¡Œæœ¬</button>
                            <button @click="retryLevel"
                                class="w-full bg-slate-700 text-slate-300 px-6 py-3 rounded-xl font-bold text-lg hover:bg-slate-600 border border-slate-600 transition-all">é‡æ–°é–‹å§‹æ­¤é—œ</button>
                        </div>

                        <!-- Right side: Stats -->
                        <div
                            class="bg-slate-900/80 p-6 rounded-2xl border border-amber-500/50 shadow-2xl w-80 flex-shrink-0">
                            <h3 class="text-xl font-bold text-slate-200 border-b border-slate-700 pb-3 mb-5">ç« ç¯€çµç®—</h3>
                            <div class="flex justify-between items-center mb-6">
                                <span class="text-slate-400 font-bold text-xl">è©•åƒ¹</span>
                                <span class="text-7xl font-black leading-none"
                                    :class="getGradeColor(calculatedGrade)">{{ calculatedGrade
                                    }}</span>
                            </div>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-slate-400">æ­£ç¢ºç‡</span>
                                <span class="text-emerald-400 font-mono font-bold text-xl">{{ accuracyPct }}%</span>
                            </div>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-slate-400">æœ€å¤§ Combo</span>
                                <span class="text-rose-400 font-mono font-bold text-xl">{{ maxComboCount }}</span>
                            </div>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-slate-400">ç²å¾—ç¶“é©—å€¼</span>
                                <span class="text-blue-400 font-mono font-bold text-xl">+{{ earnedExp }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-400">ç²å¾—é‡‘å¹£</span>
                                <span class="text-amber-400 font-mono font-bold text-xl">+{{ earnedGold }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skill Unlock Modal -->
        <div v-if="isSkillUnlockModalOpen" class="modal-overlay" @click.self="isSkillUnlockModalOpen = false"
            style="z-index: 100;">
            <div
                class="modal-panel max-w-sm rounded-[1rem] border-2 border-amber-600/60 bg-[#1e110a]/95 drop-shadow-[0_0_20px_rgba(217,119,6,0.3)] shadow-2xl overflow-hidden font-serif">
                <div class="text-6xl text-center mb-4 animate-bounce mt-4">âœ¨</div>
                <h2 class="text-2xl font-black text-amber-500 mb-6 text-center tracking-wider">æ–°æ‹›å¼ç¿’å¾—ï¼</h2>
                <div class="space-y-3 mb-8 px-2 max-h-64 overflow-y-auto custom-scrollbar">
                    <div v-for="skill in newlyUnlocked" :key="skill.id"
                        class="p-4 bg-[#3e2723]/60 rounded border border-amber-700/50 shadow-inner">
                        <div class="font-bold text-lg text-amber-400 tracking-wide">{{ skill.name }}</div>
                        <div class="text-sm text-amger-100/90 mt-2 leading-relaxed">{{ skill.meaning }}</div>
                    </div>
                </div>
                <div class="flex gap-3 px-2 mb-2">
                    <button @click="openCodexTo(newlyUnlocked[0]?.id)"
                        class="flex-1 px-4 py-3 rounded bg-gradient-to-t from-amber-700 to-amber-600 hover:from-amber-600 hover:to-amber-500 text-amber-50 text-base font-bold shadow-lg transition-colors border border-amber-500/50">
                        ğŸ“– ç«‹åˆ»ç¿»é–‹ç§˜ç¬ˆ
                    </button>
                    <button @click="isSkillUnlockModalOpen = false; resumeBattle();"
                        class="px-4 py-3 rounded bg-[#2a1c15] hover:bg-[#3e2723] text-amber-600 hover:text-amber-500 text-base font-bold shadow-lg transition-colors border border-amber-900/50">
                        ç¨å¾Œ
                    </button>
                </div>
            </div>
        </div>

        <!-- INSERT BEGIN: JPAPP_SKILL_OVERLAY_HTML_V1 -->
        <div v-if="isSkillOpen" class="fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6"
            style="background: rgba(0,0,0,0.75); backdrop-filter: blur(4px);">
            <div
                class="bg-slate-800 border-2 border-amber-500/50 rounded-2xl p-6 w-full max-w-lg shadow-[0_0_30px_rgba(0,0,0,0.8)] flex flex-col max-h-[90vh]">

                <div class="flex justify-between items-center mb-4 border-b border-slate-700 pb-3">
                    <h2 class="text-2xl font-black text-amber-400 tracking-wider">ğŸ—¡ï¸ æŠ€èƒ½</h2>
                    <div class="flex gap-2">
                        <button @click="isCodexOpen = true"
                            class="px-3 py-1.5 bg-slate-700 hover:bg-slate-600 text-slate-200 text-sm font-bold rounded-lg border border-slate-600 transition-colors">åœ–é‘‘</button>
                        <button @click="closeSkillOverlay(); resumeBattle();"
                            class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold border border-slate-600 transition-colors">âœ•</button>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto pr-2 space-y-3 custom-scrollbar">
                    <div v-for="skill in skillList" :key="skill.id" @click="castAbility(skill.id)"
                        class="group relative bg-slate-900/60 border border-slate-700 hover:border-amber-500/50 rounded-xl p-3 flex gap-4 cursor-pointer transition-all hover:bg-slate-800"
                        :class="{ 'opacity-50 grayscale cursor-not-allowed': __sp.cur < skill.cost || playerDead || monsterDead }">
                        <div
                            class="w-12 h-12 flex-shrink-0 bg-slate-800 rounded-lg flex items-center justify-center text-2xl border border-slate-600 group-hover:border-amber-400">
                            {{ skill.icon }}
                        </div>

                        <div class="flex-1 flex flex-col justify-center">
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="font-bold text-slate-200 group-hover:text-amber-300 transition-colors">{{
                                    skill.name }}</h3>
                                <span
                                    class="text-xs font-black px-2 py-0.5 rounded-full bg-cyan-900 text-cyan-300 border border-cyan-700">
                                    {{ skill.cost }} SP
                                </span>
                            </div>
                            <p class="text-xs text-slate-400 leading-snug">{{ skill.desc }}</p>
                        </div>
                    </div>

                    <div v-if="!skillList || skillList.length === 0" class="text-center py-8 text-slate-500">
                        é‚„æ²’æœ‰å­¸æœƒä»»ä½•æŠ€èƒ½...
                    </div>
                </div>
            </div>
        </div>
        <!-- INSERT END: JPAPP_SKILL_OVERLAY_HTML_V1 -->

        <!-- Codex Overlay (Spellbook) -->
        <div v-if="isCodexOpen" class="fixed inset-0 z-[2000] flex items-center justify-center p-4 md:p-8"
            @click.self="isCodexOpen = false; if (!isSkillOpen) resumeBattle();">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-black/80 backdrop-blur-sm pointer-events-none"></div>

            <!-- Book container -->
            <div class="relative w-full max-w-4xl h-full max-h-[85vh] bg-[#2a1c15] text-amber-100/90 rounded-sm border-4 border-amber-600/60 shadow-[0_0_40px_rgba(217,119,6,0.5)] flex flex-col font-serif"
                style="background-image: radial-gradient(circle at center, #3e2723 0%, #1e110a 100%);">
                <!-- Gold corners / styling -->
                <div
                    class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-amber-400/80 m-2 pointer-events-none">
                </div>
                <div
                    class="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-amber-400/80 m-2 pointer-events-none">
                </div>
                <div
                    class="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-amber-400/80 m-2 pointer-events-none">
                </div>
                <div
                    class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-amber-400/80 m-2 pointer-events-none">
                </div>

                <!-- Header -->
                <div class="text-center py-6 border-b border-amber-900/60 shadow-md relative z-10 bg-[#2a1c15]/50">
                    <h2 class="text-3xl font-black text-amber-500 tracking-widest"
                        style="text-shadow: 0 2px 4px rgba(0,0,0,0.8);">ğŸ“– æ‹›å¼åœ–é‘‘</h2>
                    <!-- Close btn -->
                    <button @click="isCodexOpen = false; if (!isSkillOpen) resumeBattle();"
                        class="absolute top-6 right-6 text-amber-600 hover:text-amber-400 transition-colors">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Content list -->
                <div class="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar relative z-10 space-y-4"
                    style="mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);">
                    <div v-for="skill in skillsWithUnlockLevel" :key="skill.id" :id="'skill-card-' + skill.id">
                        <!-- Unlocked Card -->
                        <div v-if="unlockedSkillIds.includes(skill.id)"
                            class="bg-[#3e2723]/60 border border-amber-700/50 rounded pointer-events-auto transition-all shadow-md">
                            <button @click="expandedSkillId = expandedSkillId === skill.id ? null : skill.id"
                                class="w-full text-left px-4 py-3 flex justify-between items-center hover:bg-[#4e342e]/60 transition-colors rounded">
                                <span class="font-bold text-lg text-amber-400 tracking-wide">{{ skill.name }}</span>
                                <span class="text-amber-600">{{ expandedSkillId === skill.id ? 'â–¼' : 'â–¶' }}</span>
                            </button>
                            <div v-if="expandedSkillId === skill.id"
                                class="p-4 pt-2 text-base space-y-3 bg-[#1e110a]/40 border-t border-amber-900/50">
                                <div v-if="skill.meaning"><span class="text-emerald-500 font-bold mr-2">å«ç¾©</span><span
                                        class="text-amber-100/90 leading-relaxed">{{ skill.meaning }}</span></div>
                                <div v-if="skill.rule"><span class="text-blue-400 font-bold mr-2">å¥å‹</span><span
                                        class="text-amber-100/90 leading-relaxed">{{ skill.rule }}</span></div>
                                <div v-if="skill.examples && skill.examples.length > 0">
                                    <span class="text-amber-500/80 font-bold block mb-1">ä¾‹å¥</span>
                                    <ul class="list-disc list-inside text-amber-100/80 space-y-1 ml-1">
                                        <li v-for="(ex, i) in skill.examples" :key="i">{{ ex }}</li>
                                    </ul>
                                </div>
                                <div v-if="skill.antiExamples && skill.antiExamples.length > 0">
                                    <span class="text-rose-500/80 font-bold block mb-1">èª¤ç”¨ç¯„ä¾‹</span>
                                    <ul class="list-disc list-inside text-rose-300/80 space-y-1 ml-1">
                                        <li v-for="(ex, i) in skill.antiExamples" :key="i">{{ ex }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Locked Card -->
                        <div v-else
                            class="bg-[#1e110a]/80 border border-slate-800/80 rounded p-4 flex items-center justify-between pointer-events-none opacity-60 grayscale filter shadow-inner">
                            <span class="font-bold text-slate-500 text-lg flex items-center gap-2">ğŸ”’ æœªç¿’å¾—</span>
                            <span class="text-sm font-bold text-amber-700/50">{{ skill.unlockLevel ? 'ç¬¬ ' +
                                skill.unlockLevel + ' é—œç¿’å¾—' : 'æœªå®‰æ’' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Modal -->
        <div v-if="isMenuOpen" class="modal-overlay" @click.self="isMenuOpen = false; resumeBattle();">
            <div class="modal-panel w-[400px]">
                <h2 class="text-2xl font-black text-amber-400 mb-4">â¸ Menu</h2>
                <div class="space-y-3">
                    <div class="border-b border-slate-600 pb-3">
                        <label class="flex items-center gap-2 text-sm text-slate-200 mb-2">
                            <span v-if="isMuted" class="text-lg">ğŸ”‡</span>
                            <span v-else class="text-lg">ğŸ”Š</span>
                            <button @click="isMuted = !isMuted; saveAudioSettings(); playBgm();"
                                class="flex-1 text-left underline">{{ isMuted ? 'éœéŸ³ä¸­' : 'å·²é–‹å•Ÿ' }}</button>
                        </label>
                        <label class="flex items-center gap-2 text-xs text-slate-300 mb-1">
                            <span>BGM</span>
                            <input type="range" min="0" max="1" step="0.01" v-model.number="bgmVolume"
                                @input="playBgm(); saveAudioSettings()" class="flex-1">
                        </label>
                        <label class="flex items-center gap-2 text-xs text-slate-300">
                            <span>SFX</span>
                            <input type="range" min="0" max="1" step="0.01" v-model.number="sfxVolume"
                                @input="saveAudioSettings()" class="flex-1">
                        </label>
                    </div>

                    <button @pointerdown="startRunAwayPress" @pointerup="cancelRunAwayPress"
                        @pointerleave="cancelRunAwayPress" @pointercancel="cancelRunAwayPress" @contextmenu.prevent
                        class="relative w-full px-4 py-3 rounded-lg bg-rose-900/60 border border-rose-500/50 hover:border-rose-400 text-white text-sm font-bold shadow-lg transition-all overflow-hidden select-none"
                        :class="{'scale-95': isRunAwayPressing}">
                        <div class="absolute left-0 top-0 bottom-0 bg-rose-500 pointer-events-none"
                            :style="{ width: isRunAwayPressing ? '100%' : '0%', transition: isRunAwayPressing ? 'width 3s linear' : 'width 0.2s ease-out' }">
                        </div>
                        <span class="relative z-10 drop-shadow-md">ğŸƒ é•·æŒ‰ 3 ç§’é€ƒå›é¦–é </span>
                    </button>

                    <button @click="openChangelog();"
                        class="w-full px-4 py-3 rounded-lg bg-indigo-900/60 border border-indigo-500/50 hover:border-indigo-400 text-white text-sm font-bold shadow-lg transition-all">
                        ğŸ“‹ æ›´æ–°æ—¥èªŒ
                    </button>
                </div>
                <button @click="isMenuOpen = false; resumeBattle();"
                    class="mt-4 w-full px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white text-xs font-bold">é—œé–‰</button>
            </div>
        </div>

        <!-- Changelog Modal -->
        <div v-if="isChangelogOpen" class="modal-overlay" @click.self="isChangelogOpen = false">
            <div class="modal-panel w-[500px] h-[70vh] flex flex-col">
                <h2 class="text-2xl font-black text-indigo-400 mb-4 flex-shrink-0">ğŸ“‹ ç³»çµ±æ›´æ–°æ—¥èªŒ</h2>

                <div v-if="changelogError" class="text-rose-400 text-center py-10 font-bold flex-1">
                    è®€å–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†ï¼ˆç‰ˆæœ¬ï¼šv{{ appVersion }}ï¼‰
                </div>
                <div v-else-if="changelogData.length === 0" class="text-slate-400 text-center py-10 flex-1">
                    è¼‰å…¥ä¸­...
                </div>
                <div v-else class="flex-1 overflow-y-auto custom-scrollbar space-y-4 pr-2 pb-4">
                    <div v-for="(entry, index) in changelogData" :key="index"
                        class="p-4 bg-slate-800/60 rounded-xl border border-indigo-500/30">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-indigo-300 font-bold text-lg leading-none">v{{ entry.version }}</span>
                            <span class="text-slate-500 text-xs mt-1">{{ entry.date }}</span>
                        </div>
                        <ul class="list-disc list-inside text-slate-300 text-sm space-y-1 ml-1">
                            <li v-for="(change, cIndex) in entry.changes" :key="cIndex">{{ change }}</li>
                        </ul>
                    </div>
                </div>

                <div class="flex justify-end gap-2 mt-4 flex-shrink-0 pt-4 border-t border-slate-700">
                    <button @click="isChangelogOpen = false"
                        class="px-6 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold shadow-md">é—œé–‰</button>
                </div>
            </div>
        </div>

        <!-- Mistakes Modal -->
        <div v-if="isMistakesOpen" class="modal-overlay" @click.self="isMistakesOpen = false">
            <div class="modal-panel">
                <h2 class="text-2xl font-black text-blue-400 mb-4">ğŸ“’ éŒ¯é¡Œæœ¬</h2>
                <div v-if="mistakes.length === 0" class="text-slate-400 text-center py-6">å°šç„¡éŒ¯é¡Œã€‚</div>
                <div v-else class="space-y-2 mb-4">
                    <div v-for="(m, i) in mistakes.slice(0, 20)" :key="i"
                        class="p-2 bg-slate-700/50 rounded border-l-3 border-blue-500">
                        <div class="text-slate-200 font-bold text-sm mb-1">{{ m.prompt }}</div>
                        <div class="text-amber-300 text-xs mb-1">æ­£è§£: {{ formatCorrect(m.correct) }}</div>
                        <div v-if="m.grammarTip" class="text-slate-400 text-xs">{{ m.grammarTip }}</div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button @click="clearMistakes"
                        class="flex-1 px-3 py-2 rounded-lg bg-red-600/60 hover:bg-red-500 text-white text-sm font-bold whitespace-nowrap flex items-center justify-center gap-1">ğŸ—‘
                        æ¸…ç©º</button>
                    <button @click="isMistakesOpen = false"
                        class="flex-1 px-3 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold whitespace-nowrap">é—œé–‰</button>
                </div>
            </div>
        </div>

        <div v-if="flashOverlay" class="flash-overlay"></div>

        <!-- Inventory Modal -->
        <div v-if="isInventoryOpen" class="modal-overlay" @click.self="isInventoryOpen = false; resumeBattle();">
            <div class="modal-panel w-[400px]">
                <h2 class="text-2xl font-black text-emerald-400 mb-4 flex items-center gap-2">ğŸ’ å†’éšªè€…èƒŒåŒ…</h2>

                <div class="space-y-3 mb-4">
                    <!-- Speed Potion Item -->
                    <div class="flex items-center gap-3 bg-slate-700/50 p-3 rounded-xl border border-slate-600/50">
                        <div
                            class="w-12 h-12 flex-shrink-0 bg-gradient-to-tr from-cyan-900 to-cyan-500 rounded-lg flex items-center justify-center text-2xl shadow-inner border border-cyan-400/30">
                            ğŸ’¨
                        </div>
                        <div class="flex-1">
                            <h3 class="text-slate-100 font-bold text-base flex justify-between items-center">
                                ç¥é€Ÿè—¥æ°´
                                <span
                                    class="bg-cyan-600/50 text-cyan-200 text-xs px-2 py-0.5 rounded-full border border-cyan-500/30">x
                                    {{ inventory.speedPotions }}</span>
                            </h3>
                            <p class="text-slate-400 text-xs mt-1 leading-relaxed">
                                é£²ç”¨å¾Œçš„ä¸€åˆ†é˜å…§ï¼Œé¢å°æ€ªç‰©çš„æ¥ä¸‹ä¾† 6 æ¬¡æ”»æ“Šï¼Œè‡ªèº«é–ƒé¿ç‡æå‡è‡³ <span class="text-amber-400 font-bold">50%</span>ã€‚
                            </p>
                            <div v-if="evasionBuffAttacksLeft > 0"
                                class="text-cyan-300 text-xs mt-1 font-bold animate-pulse">æ•ˆæœæŒçºŒä¸­... (å‰©é¤˜ {{
                                evasionBuffAttacksLeft }} æ¬¡)</div>
                        </div>
                        <button @click="useSpeedPotion"
                            class="shrink-0 px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-bold rounded-lg transition-transform active:scale-95 shadow-md disabled:opacity-50 disabled:grayscale disabled:cursor-not-allowed"
                            :disabled="inventory.speedPotions <= 0 || evasionBuffAttacksLeft > 0 || monsterDead || playerDead">
                            ä½¿ç”¨
                        </button>
                    </div>

                    <!-- Other item placeholders could go here -->
                </div>

                <div class="flex gap-2">
                    <button @click="isInventoryOpen = false; resumeBattle();"
                        class="w-full px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold shadow-md">é—œé–‰</button>
                </div>
            </div>
        </div>

        <!-- --- INSERT BEGIN: JPAPP_L2_DEBUG_V1 --- -->
        <div v-if="showL2DebugPanel"
            class="fixed inset-0 z-[999] bg-slate-900/95 flex flex-col p-4 w-full h-full font-mono text-sm">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-slate-700">
                <h2 class="text-xl font-bold text-amber-400">L2 é¡Œç›®æª¢æŸ¥æ¨¡å¼ (GA_EXIST)</h2>
                <div class="flex gap-4">
                    <button @click="generateL2Debug"
                        class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold shadow-md active:translate-y-px">
                        ç”Ÿæˆ 60 é¡Œ
                    </button>
                    <button @click="copyL2Debug"
                        class="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded font-bold shadow-md active:translate-y-px"
                        :disabled="l2DebugQuestions.length === 0">
                        Copy ç´”æ–‡å­—
                    </button>
                    <button @click="showL2DebugPanel = false"
                        class="bg-rose-600 hover:bg-rose-500 text-white px-4 py-2 rounded font-bold shadow-md active:translate-y-px">
                        é—œé–‰
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-auto bg-slate-800 rounded border border-slate-700 p-2 custom-scrollbar">
                <table class="w-full text-left border-collapse">
                    <thead class="sticky top-0 bg-slate-900 shadow-md">
                        <tr>
                            <th class="p-2 border-b border-slate-700 text-slate-400 w-12 text-center">#</th>
                            <th class="p-2 border-b border-slate-700 text-slate-400 w-24">Src</th>
                            <th class="p-2 border-b border-slate-700 text-slate-400 w-1/2">Sentence</th>
                            <th class="p-2 border-b border-slate-700 text-slate-400">Ans</th>
                            <th class="p-2 border-b border-slate-700 text-slate-400">Skill</th>
                            <th class="p-2 border-b border-slate-700 text-slate-400">Issue / Flags</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-if="l2DebugQuestions.length === 0">
                            <td colspan="5" class="p-8 text-center text-slate-500 italic">å°šæœªç”Ÿæˆé¡Œç›®ï¼Œè«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•</td>
                        </tr>
                        <tr v-for="(q, idx) in l2DebugQuestions" :key="idx"
                            class="border-b border-slate-700/50 hover:bg-slate-700/30 transition-colors"
                            :class="{'bg-rose-900/40': q.isBad, 'bg-emerald-900/20': q.sourceLevel === 'L1-review'}">
                            <td class="p-2 text-center text-slate-500">{{ idx + 1 }}</td>
                            <td class="p-2 text-slate-400 text-xs">{{ q.sourceLevel }}</td>
                            <td class="p-2 text-slate-200">{{ q.text }}</td>
                            <td class="p-2">
                                <span
                                    class="bg-amber-500/20 text-amber-300 px-2 py-0.5 rounded border border-amber-500/30">{{
                                    q.answer }}</span>
                            </td>
                            <td class="p-2 text-slate-400 text-xs">{{ q.skillId }}</td>
                            <td class="p-2">
                                <span v-if="q.isBad"
                                    class="text-rose-400 font-bold drop-shadow-[0_0_2px_rgba(225,29,72,0.8)]">
                                    âš ï¸ {{ q.errorMsg }}
                                </span>
                                <span v-else class="text-emerald-500/50">OK</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- --- INSERT END: JPAPP_L2_DEBUG_V1 --- -->

    </div>

    <script src="assets/js/game.js?v=26022703" defer></script>
</body>

</html>

